<%= render 'layouts/sidebar_menu' %>
       <div id="page-wrapper">
           <div class="row">
               <div class="col-lg-12">
                   <h3 class="page-header">Patient Profile for "<%=@user.username %>"</h3>
               </div>
               <!-- /.col-lg-12 -->
           </div>
           <!-- /.row -->
           <div class="row">
                       <!-- /.panel-heading -->
                    <div class="panel-body">
                         <div class="row">
                   <div class="col-lg-12">
                       <div class="panel panel-default">
                           <div class="panel-heading">
                             Patient Profile for: <%=@user.username%>
                           </div>
                           <!-- /.panel-heading -->
                           <div class="panel-body">
                               <!-- Nav tabs -->
                               <ul class="nav nav-tabs">
                                   <li class="active"><a href="#home" data-toggle="tab">Profile</a>
                                   </li>
                                   <li><a href="#profile" data-toggle="tab">Latest Measurements</a>
                                   </li>
                                   <li><a href="#messages" data-toggle="tab">ΒΜΙ Calculation</a>
                                   </li>
                                  
                               </ul>

                               <!-- Tab panes -->
                               <div class="tab-content">
                                   <div class="tab-pane fade in active" id="home">
                                       <h4>Patient Profile:</h4>
                                       <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                                   </div>
                                   <div class="tab-pane fade" id="profile">
                                       <h4>Latest Measurements:</h4>
                                       <div class="table-responsive">
                                           <table class="table table-hover">
                                               <thead>
                                                   <tr>
                                                       <!-- <th>Device Id</th> -->
                                                       <th>Device Name</th>
                                                       <th>Type of Measure</th>
                                                       <th>Measure Value</th>
                                                       <th>Last Updated</th>
                                                   </tr>
                                               </thead>
                                               <tbody>
                                                 <% Device.all.each do |dev| %>
                                                   <% dev.measures.each do |measure| %>
                                                     <% @data = @user.measurements.where(:device_id => dev.id, :measure_id => measure.id).order(:created_at => "desc").pluck(:created_at, :measure_value).first %>
                                                     <tr>
                                                       <!-- <td><%=dev.id%></tb>-->
                                                       <td><%=dev.name%></tb>
                                                       <td><%=measure.name%></td>
                                                       <%if @data.nil? %>
                                                         <td>no data</td>
                                                         <td>no data</td>
                                                      <%else%>
                                                       <td><%=@data[1]%></td>
                                                       <td><%=@data[0]%></td>
                                                      <%end%>
                                                      </tr>
                                                    <% end %>
                                                 <% end %>
                                               </tbody>
                                           </table>
                                       </div>

                                   </div>
                                   <div class="tab-pane fade" id="messages">
                                     <div class="row">
                                         <div class="col-lg-12">
                                             <h3 class="page-header">Age/ΒΜΙ/%Body Fat Calculation:</h3>
                                         </div>
                                         <!-- /.col-lg-12 -->
                                     </div>
                                     <div class="row">
                                         <div class="col-lg-12">
                                           <div class="panel panel-default">
                                                 <div class="panel-heading">
                                                     Calculation using Device: <%=@device_name %>
                                                 </div>
                                                 <div class="panel-body">


                                        <div class="row">

                                          <!-- /.col-lg-4 -->
                                          <div class="col-lg-4">
                                              <div class="well well-sm">
                                                  <h4>Your current age(years):</h4>
                                                  <p><h3><%=number_with_precision(@current_age,precision: 2)%></h3></p>
                                              </div>
                                          </div>
                                          <% if !@sex.nil? %>
                                            <div class="col-lg-4">
                                              <div class="well well-sm">
                                                  <h4>Your current BMI:</h4>
                                                  <p><h3><%=number_with_precision(@bmi, precision: 2)%></h3></p>
                                              </div>

                                            </div>
                                            <div class="col-lg-4">
                                              <div class="well well-sm">
                                                  <h4>Your current Body Fat %:</h4>
                                                  <p><h3><%=number_with_precision(@body_fat, precision: 2)%></h3></p>
                                              </div>
                                            </div>
                                            <%elsif @sex.nil? %>
                                              <div class="col-lg-4">
                                                <div class="well well-sm">
                                                  <h4>Your current BMI:</h4>
                                                  <p><h3><%=@error_message %></h3></p>
                                                </div>
                                              </div>
                                              <div class="col-lg-4">
                                                <div class="well well-sm">
                                                  <h4>Your current Body Fat %:</h4>
                                                  <p><h3><%=@error_message%></h3></p>
                                                </div>
                                              </div>
                                            <% end %>

                                      </div>
                                   </div>
                                
                               </div>
                           </div>
                           <!-- /.panel-body -->
                       </div>
                       <!-- /.panel -->
                   </div>
                 </div>
                       </div>
                       <!-- /.panel-body -->
                   </div>
                   <!-- /.panel -->
</div>
</div>
</div>
</div>
     <div class="row">
                 <div class="col-lg-12">
              <div class="panel panel-default">
                        <div class="panel-heading">
                            Raw Data:
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="table-responsive" style="overflow-x: hidden">
                                <table id="patients-raw-data" class="table table-striped table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>Measure Value</th>
                                            <th>Device</th>
											<th>Measure Type</th>
											<th>Created at</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% @user_measurements.each do |dataelements| %>
                                        <tr>
                                          <td><%=dataelements.measure_value %></td>
                                          <td><%=Device.find(dataelements.device_id).name %></td>
										  <td><%=Measure.find(dataelements.measure_id).name %></td>
                                          <td><%=dataelements.created_at %>
                                        </tr>
                                        <% end %>
                                    </tbody>
                                </table>
                            </div>
                            <!-- /.table-responsive -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
            </div>
            <!-- /.row -->
        </div>

</div>
